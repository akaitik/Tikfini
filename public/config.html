<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üíÄBIENVENIDO AKAIüíÄ</title>
  <style>
    :root {
      --bg-main: #101317;
      --bg-panel: #181c22;
      --bg-panel-alt: #15181e;
      --border-soft: #2a2f38;
      --accent: #1e90ff;
      --accent-soft: #3fa9ff;
      --danger: #ff4b4b;
      --text-main: #f5f5f5;
      --text-muted: #a0a4b0;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      background: radial-gradient(circle at top, #181c22 0, #05070a 50%, #000 100%);
      font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color: var(--text-main);
      min-height: 100vh;
    }

    .app {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar fake (solo decorativa para parecer app) */
    .sidebar {
      width: 230px;
      background: #05070a;
      border-right: 1px solid #14171d;
      padding: 15px 0;
      color: var(--text-muted);
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      padding: 0 20px 15px;
      border-bottom: 1px solid #14171d;
      margin-bottom: 10px;
    }

    .sidebar-title {
      font-size: 18px;
      font-weight: 700;
      color: #ffffff;
    }

    .sidebar-user {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .sidebar-section-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: .08em;
      padding: 10px 20px 5px;
      color: var(--text-muted);
    }

    .sidebar-item {
      padding: 8px 20px;
      font-size: 13px;
      cursor: default;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .sidebar-item.active {
      background: linear-gradient(90deg, rgba(30,144,255,0.2), transparent);
      color: var(--text-main);
      border-left: 3px solid var(--accent);
    }

    .sidebar-item span.icon {
      width: 18px;
      text-align: center;
    }

    /* Main layout */
    .main {
      flex: 1;
      padding: 20px 26px;
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
    }

    .topbar-title {
      font-size: 24px;
      font-weight: 700;
      color: #ffffff;
      text-shadow: 0 0 18px rgba(255,0,0,0.6);
    }

    .topbar-sub {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .badge-live {
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(255,75,75,0.1);
      border: 1px solid var(--danger);
      color: var(--danger);
      font-size: 11px;
      font-weight: 600;
    }

    .main-panels {
      display: grid;
      grid-template-columns: 2.3fr 1fr;
      gap: 18px;
    }

    .panel {
      background: var(--bg-panel);
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      box-shadow: 0 12px 30px rgba(0,0,0,0.6);
      padding: 14px 16px 16px;
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .panel-title {
      font-size: 14px;
      font-weight: 600;
      color: #ffffff;
    }

    .panel-subtitle {
      font-size: 11px;
      color: var(--text-muted);
    }

    .btn {
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      font-size: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
    }

    .btn-primary:hover {
      background: var(--accent-soft);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-muted);
    }

    .btn-ghost:hover {
      background: var(--bg-panel-alt);
    }

    .btn-danger {
      background: var(--danger);
      color: #fff;
    }

    .btn-danger:hover {
      background: #ff2d2d;
    }

    /* Tabla principal */
    .table-wrapper {
      margin-top: 8px;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid #262b35;
      background: var(--bg-panel-alt);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    thead {
      background: #14171d;
    }

    th, td {
      padding: 6px 8px;
      text-align: left;
      border-bottom: 1px solid #262b35;
    }

    th {
      font-weight: 600;
      color: var(--text-muted);
      font-size: 11px;
    }

    tbody tr:hover {
      background: rgba(255,255,255,0.02);
    }

    .col-enabled {
      width: 40px;
      text-align: center;
    }

    .col-actions {
      width: 40px;
      text-align: center;
    }

    .toggle {
      width: 32px;
      height: 16px;
      border-radius: 999px;
      background: #2b3038;
      position: relative;
      cursor: pointer;
      display: inline-block;
      vertical-align: middle;
    }

    .toggle::after {
      content: "";
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #888;
      position: absolute;
      top: 2px;
      left: 3px;
      transition: all .15s;
    }

    .toggle.on {
      background: rgba(30,144,255,0.4);
    }

    .toggle.on::after {
      left: 17px;
      background: #1e90ff;
    }

    select, input[type="number"] {
      width: 100%;
      background: #0f1116;
      border: 1px solid #262b35;
      border-radius: 4px;
      padding: 4px 6px;
      color: var(--text-main);
      font-size: 11px;
    }

    select:focus, input[type="number"]:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(30,144,255,0.5);
    }

    .sound-select-btn {
      width: 100%;
      background: #151920;
      border: 1px solid #262b35;
      border-radius: 4px;
      padding: 4px 6px;
      color: var(--text-main);
      text-align: left;
      cursor: pointer;
      font-size: 11px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .sound-select-btn span.label {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .slider-wrapper {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .slider-wrapper input[type="range"] {
      flex: 1;
      accent-color: var(--accent);
    }

    .slider-wrapper span {
      font-size: 10px;
      color: var(--text-muted);
      width: 28px;
      text-align: right;
    }

    /* panel lateral */
    .setting-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 4px 0;
      font-size: 12px;
      color: var(--text-muted);
    }

    .setting-row strong {
      color: var(--text-main);
    }

    .pill {
      padding: 2px 8px;
      border-radius: 999px;
      background: #111318;
      border: 1px solid #262b35;
      font-size: 11px;
      color: var(--text-muted);
    }

    .helper {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 6px;
    }

    .helper a {
      color: var(--accent-soft);
      text-decoration: none;
    }

    .helper a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Sidebar decorativa -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-title">TikFinity Akai</div>
        <div class="sidebar-user">@akai120_</div>
      </div>

      <div class="sidebar-section-title">Overlays</div>
      <div class="sidebar-item"><span class="icon">üéØ</span>Goal Overlays</div>
      <div class="sidebar-item"><span class="icon">üñºÔ∏è</span>Gift Overlays</div>
      <div class="sidebar-item active"><span class="icon">üîä</span>Sound Alerts</div>

      <div class="sidebar-section-title">Tools</div>
      <div class="sidebar-item"><span class="icon">‚öôÔ∏è</span>General Settings</div>
      <div class="sidebar-item"><span class="icon">üß™</span>Test Panel</div>
    </aside>

    <!-- Contenido principal -->
    <main class="main">
      <div class="topbar">
        <div>
          <div class="topbar-title">üíÄBIENVENIDO AKAIüíÄ</div>
          <div class="topbar-sub">Configura qu√© sonido suena para cada regalo o interacci√≥n.</div>
        </div>
        <div class="badge-live">config.html ‚Ä¢ editor local</div>
      </div>

      <div class="main-panels">
        <!-- Panel principal tabla -->
        <section class="panel">
          <div class="panel-header">
            <div>
              <div class="panel-title">Sound Alerts</div>
              <div class="panel-subtitle">Cada fila es un trigger (gift / follow / like) con su sonido y volumen.</div>
            </div>
            <div>
              <button class="btn btn-primary" onclick="addRow()">+ Crear alerta</button>
              <button class="btn btn-ghost" onclick="resetFromConfig()">‚Üª Recargar</button>
            </div>
          </div>

          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th class="col-enabled">On</th>
                  <th>Trigger</th>
                  <th>Sound</th>
                  <th>Volume</th>
                  <th>Duraci√≥n (ms)</th>
                  <th class="col-actions">Del</th>
                </tr>
              </thead>
              <tbody id="alerts-body">
                <!-- filas generadas por JS -->
              </tbody>
            </table>
          </div>
        </section>

        <!-- Panel lateral -->
        <section class="panel">
          <div class="panel-header">
            <div class="panel-title">Settings</div>
          </div>

          <div class="setting-row">
            <span>Play sounds simultaneously</span>
            <span class="pill">On</span>
          </div>
          <div class="setting-row">
            <span>Play only first emote</span>
            <span class="pill">Off</span>
          </div>
          <div class="setting-row">
            <span>Max queue length</span>
            <span class="pill">Unlimited</span>
          </div>

          <div class="helper">
            ‚Ä¢ Los cambios se aplican solo a <code>config.json</code>.<br>
            ‚Ä¢ Pulsa ‚ÄúGuardar config.json‚Äù y s√∫belo a tu repo.<br>
          </div>

          <div style="margin-top:14px">
            <button class="btn btn-primary" style="width:100%" onclick="downloadConfig()">üíæ Guardar config.json</button>
          </div>
          <div style="margin-top:8px">
            <button class="btn btn-danger" style="width:100%" onclick="clearAll()">üß® Vaciar todo (gifts/interactions)</button>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script>
    // Estado en memoria
    let config = { username: "akai120_", gifts: {}, interactions: {} };

    // Lista de triggers conocidos
    const TRIGGERS = [
      "rosa","corazon","estrella","perfume","leon","dragon","galaxia","cohete","unicornio",
      "follow","like","share","fan_emoji"
    ];

    // Cargar config.json
    fetch("./config.json")
      .then(r => r.json())
      .then(data => {
        config = data;
        if (!config.gifts) config.gifts = {};
        if (!config.interactions) config.interactions = {};
        buildTableFromConfig();
      })
      .catch(() => {
        buildTableFromConfig();
      });

    function buildTableFromConfig() {
      const tbody = document.getElementById("alerts-body");
      tbody.innerHTML = "";

      // gifts
      Object.entries(config.gifts || {}).forEach(([key, value]) => {
        addRowFromConfig("gift", key, value);
      });

      // interactions
      Object.entries(config.interactions || {}).forEach(([key, value]) => {
        addRowFromConfig("interaction", key, value);
      });

      if (!tbody.children.length) {
        // a√±ade algunas filas por defecto
        ["rosa","corazon","follow","like"].forEach(t => addRow(t.startsWith("rosa") || t.startsWith("corazon") ? "gift" : "interaction", t));
      }
    }

    function addRowFromConfig(kind, key, value) {
      const enabled = value.enabled !== false;
      const volume = value.volume != null ? value.volume : 1;
      const duration = value.duration || 4000;
      addRow(kind, key, value.media || "", value.sound || "", enabled, volume, duration, false);
    }

    function addRow(kind = "gift", triggerKey = "", media = "", sound = "", enabled = true, volume = 1, duration = 4000, focus = false) {
      const tbody = document.getElementById("alerts-body");
      const tr = document.createElement("tr");
      tr.dataset.kind = kind;

      tr.innerHTML = `
        <td class="col-enabled">
          <div class="toggle ${enabled ? "on" : ""}" onclick="toggleEnabled(this)"></div>
        </td>
        <td>
          <select onchange="onTriggerChange(this)">
            ${TRIGGERS.map(t => `<option value="${t}" ${t === triggerKey ? "selected" : ""}>${t.toUpperCase()}</option>`).join("")}
          </select>
        </td>
        <td>
          <button class="sound-select-btn" onclick="editSound(this)">
            <span class="label">${sound || "Select sound"}</span>
            <span>‚ñæ</span>
          </button>
        </td>
        <td>
          <div class="slider-wrapper">
            <input type="range" min="0" max="1" step="0.05" value="${volume}">
            <span>${Math.round(volume * 100)}%</span>
          </div>
        </td>
        <td>
          <input type="number" value="${duration}" min="500" max="20000">
        </td>
        <td class="col-actions">
          <button class="btn btn-ghost" onclick="deleteRow(this)">üóëÔ∏è</button>
        </td>
      `;

      // evento slider
      const range = tr.querySelector('input[type="range"]');
      range.addEventListener("input", () => {
        tr.querySelector(".slider-wrapper span").textContent = `${Math.round(range.value * 100)}%`;
      });

      tbody.appendChild(tr);
      if (focus) tr.querySelector("select").focus();
    }

    function toggleEnabled(el) {
      el.classList.toggle("on");
    }

    function deleteRow(btn) {
      const tr = btn.closest("tr");
      tr.remove();
    }

    function onTriggerChange(selectEl) {
      // opcional: evitar triggers duplicados, etc.
    }

    function editSound(btn) {
      const current = btn.querySelector(".label").textContent;
      const file = prompt("Ruta del sonido (ej: ./sounds/basicos/rosa.mp3):", current === "Select sound" ? "" : current);
      if (file !== null && file.trim() !== "") {
        btn.querySelector(".label").textContent = file.trim();
      }
    }

    function resetFromConfig() {
      buildTableFromConfig();
    }

    function clearAll() {
      if (!confirm("¬øSeguro que quieres borrar TODAS las entradas de gifts e interactions de config.json?")) return;
      config.gifts = {};
      config.interactions = {};
      buildTableFromConfig();
    }

    function downloadConfig() {
      // reconstruir config desde la tabla
      const tbody = document.getElementById("alerts-body");
      const rows = Array.from(tbody.querySelectorAll("tr"));

      const newGifts = {};
      const newInter = {};

      rows.forEach(tr => {
        const kind = tr.dataset.kind || "gift";
        const enabled = tr.querySelector(".toggle").classList.contains("on");
        const trigger = tr.querySelector("select").value;
        const sound = tr.querySelector(".sound-select-btn .label").textContent;
        const volume = parseFloat(tr.querySelector('input[type="range"]').value);
        const duration = parseInt(tr.querySelector('input[type="number"]').value) || 4000;

        const obj = {
          enabled: enabled,
          sound: sound !== "Select sound" ? sound : "",
          duration,
          volume
        };

        // aqu√≠ podr√≠as mapear media si quieres; por ahora solo sonido
        if (kind === "gift") {
          obj.minCoins = (config.gifts && config.gifts[trigger] && config.gifts[trigger].minCoins) || 1;
          newGifts[trigger] = Object.assign({}, config.gifts[trigger] || {}, obj);
        } else {
          newInter[trigger] = Object.assign({}, config.interactions[trigger] || {}, obj);
        }
      });

      config.gifts = newGifts;
      config.interactions = newInter;

      const dataStr = JSON.stringify(config, null, 2);
      const uri = "data:application/json;charset=utf-8," + encodeURIComponent(dataStr);
      const link = document.createElement("a");
      link.href = uri;
      link.download = "config.json";
      link.click();
    }
  </script>
</body>
</html>
