<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel de configuraci√≥n de alertas</title>
  <style>
    :root {
      --bg-main: #111318;
      --bg-panel: #181b22;
      --bg-panel-alt: #15181f;
      --border-soft: #262a33;
      --accent: #1e90ff;
      --danger: #ff4b4b;
      --text-main: #f5f5f5;
      --text-muted: #a0a4b0;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg-main);
      color: var(--text-main);
      min-height: 100vh;
    }

    .layout {
      display: grid;
      grid-template-columns: 260px 1fr;
      min-height: 100vh;
    }

    /* Sidebar simple */
    .sidebar {
      background: #0a0c10;
      border-right: 1px solid #10131a;
      padding: 16px 14px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      color: var(--text-muted);
      font-size: 13px;
    }

    .sidebar-title {
      font-size: 18px;
      font-weight: 600;
      color: #ffffff;
    }

    .sidebar-user {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 2px;
      margin-bottom: 10px;
    }

    .sidebar-section {
      margin-top: 16px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: .08em;
      color: var(--text-muted);
    }

    .sidebar-item {
      margin-top: 6px;
      padding: 6px 8px;
      border-radius: 4px;
      cursor: default;
    }

    .sidebar-item.active {
      background: #151922;
      border-left: 3px solid var(--accent);
      padding-left: 5px;
      color: var(--text-main);
    }

    /* Main */
    .main {
      padding: 18px 22px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
    }

    .header-title {
      font-size: 22px;
      font-weight: 600;
    }

    .header-sub {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .tag {
      font-size: 11px;
      color: var(--text-muted);
      padding: 4px 8px;
      border-radius: 99px;
      border: 1px solid var(--border-soft);
    }

    .content {
      display: grid;
      grid-template-columns: minmax(0, 1.9fr) minmax(260px, 0.9fr);
      gap: 16px;
    }

    .panel {
      background: var(--bg-panel);
      border-radius: 8px;
      border: 1px solid var(--border-soft);
      padding: 12px 14px 14px;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .panel-title {
      font-size: 14px;
      font-weight: 600;
    }

    .panel-sub {
      font-size: 11px;
      color: var(--text-muted);
    }

    .btn {
      border: 1px solid var(--border-soft);
      border-radius: 4px;
      background: #151922;
      color: var(--text-main);
      font-size: 11px;
      padding: 5px 10px;
      cursor: pointer;
    }

    .btn.primary {
      border-color: var(--accent);
      background: var(--accent);
      color: #fff;
    }

    .btn.danger {
      border-color: var(--danger);
      background: var(--danger);
      color: #fff;
    }

    .btn + .btn {
      margin-left: 6px;
    }

    /* Tabla */
    .table-wrapper {
      margin-top: 6px;
      border-radius: 6px;
      overflow: hidden;
      border: 1px solid #222632;
      background: var(--bg-panel-alt);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    thead {
      background: #141821;
    }

    th, td {
      padding: 6px 8px;
      border-bottom: 1px solid #222632;
      text-align: left;
      vertical-align: middle;
    }

    th {
      font-size: 11px;
      color: var(--text-muted);
      font-weight: 600;
    }

    tbody tr:hover {
      background: #191d27;
    }

    .col-enabled { width: 40px; text-align: center; }
    .col-type { width: 80px; }
    .col-trigger { width: 140px; }
    .col-actions { width: 40px; text-align: center; }

    .toggle {
      width: 30px;
      height: 16px;
      border-radius: 999px;
      background: #272b34;
      position: relative;
      cursor: pointer;
      margin: 0 auto;
    }

    .toggle::after {
      content: "";
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #888;
      position: absolute;
      top: 2px;
      left: 3px;
      transition: all .15s;
    }

    .toggle.on {
      background: rgba(30,144,255,0.5);
    }

    .toggle.on::after {
      left: 15px;
      background: #1e90ff;
    }

    select, input[type="number"], input[type="text"] {
      width: 100%;
      background: #10131a;
      border: 1px solid #262b35;
      border-radius: 4px;
      padding: 4px 5px;
      color: var(--text-main);
      font-size: 11px;
    }

    select:focus, input[type="number"]:focus, input[type="text"]:focus {
      outline: none;
      border-color: var(--accent);
    }

    .sound-btn {
      width: 100%;
      background: #151922;
      border: 1px solid #262b35;
      border-radius: 4px;
      padding: 4px 5px;
      color: var(--text-main);
      font-size: 11px;
      text-align: left;
      cursor: pointer;
    }

    .sound-btn span {
      display: inline-block;
      max-width: 100%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .slider-wrapper {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .slider-wrapper input[type="range"] {
      flex: 1;
      accent-color: var(--accent);
    }

    .slider-wrapper span {
      width: 32px;
      text-align: right;
      font-size: 10px;
      color: var(--text-muted);
    }

    .settings-row {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      margin: 4px 0;
      color: var(--text-muted);
    }

    .settings-row strong {
      color: var(--text-main);
    }

    .hint {
      margin-top: 8px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .hint code {
      background: #10131a;
      padding: 2px 4px;
      border-radius: 3px;
    }
  </style>
</head>
<body>
  <div class="layout">
    <!-- Sidebar utilitaria -->
    <aside class="sidebar">
      <div>
        <div class="sidebar-title">Alertas Akai</div>
        <div class="sidebar-user">@akai120_ ¬∑ config.html</div>
      </div>

      <div class="sidebar-section">Paneles</div>
      <div class="sidebar-item active">Sound Alerts</div>
      <div class="sidebar-item">Gift Overlays</div>
      <div class="sidebar-item">General Settings</div>

      <div class="sidebar-section">Informaci√≥n</div>
      <div style="font-size:11px; color:var(--text-muted);">
        Este panel solo edita <code>config.json</code>.<br>
        El overlay de alertas lo lee en <code>alerts.html</code>.
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <header class="header">
        <div>
          <div class="header-title">Sound Alerts</div>
          <div class="header-sub">
            Cada fila representa un evento (follow, gift, like, etc.) y la acci√≥n asociada (sonido + duraci√≥n).
          </div>
        </div>
        <div class="tag">Modo t√©cnico ¬∑ event ‚Üí acci√≥n</div>
      </header>

      <div class="content">
        <!-- Panel principal -->
        <section class="panel">
          <div class="panel-header">
            <div>
              <div class="panel-title">Lista de alertas</div>
              <div class="panel-sub">Activa/desactiva, asigna sonidos y ajusta volumen/duraci√≥n.</div>
            </div>
            <div>
              <button class="btn" onclick="reloadFromConfig()">Recargar</button>
              <button class="btn primary" onclick="addRow()">A√±adir alerta</button>
            </div>
          </div>

          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th class="col-enabled">On</th>
                  <th class="col-type">Tipo</th>
                  <th class="col-trigger">Evento</th>
                  <th>Sonido</th>
                  <th>Volumen</th>
                  <th>Duraci√≥n (ms)</th>
                  <th class="col-actions">Del</th>
                </tr>
              </thead>
              <tbody id="rows">
                <!-- filas generadas por JS -->
              </tbody>
            </table>
          </div>
        </section>

        <!-- Panel lateral -->
        <section class="panel">
          <div class="panel-header">
            <div class="panel-title">Opciones</div>
          </div>

          <div class="settings-row">
            <span>Volumen por defecto</span>
            <strong>100%</strong>
          </div>
          <div class="settings-row">
            <span>Duraci√≥n por defecto</span>
            <strong>4000 ms</strong>
          </div>

          <div class="hint">
            ‚Ä¢ Este panel no reproduce audio, solo configura rutas y valores.<br>
            ‚Ä¢ Aseg√∫rate de que los sonidos existan en <code>./sounds/</code>.<br>
            ‚Ä¢ Para probarlas visualmente, usa el overlay real en <code>alerts.html</code>.
          </div>

          <div style="margin-top:12px;">
            <button class="btn primary" style="width:100%" onclick="downloadConfig()">üíæ Guardar config.json</button>
          </div>
          <div style="margin-top:6px;">
            <button class="btn danger" style="width:100%" onclick="clearAll()">üß® Vaciar (gifts + interactions)</button>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script>
    let config = { username: "akai120_", gifts: {}, interactions: {} };

    const EVENT_TYPES = [
      { value: "gift", label: "Gift" },
      { value: "interaction", label: "Interaction" }
    ];

    const TRIGGERS = [
      "rosa","corazon","estrella","perfume","leon","dragon","galaxia","cohete","unicornio",
      "follow","like","share","fan_emoji"
    ];

    const DEFAULT_DURATION = 4000;
    const DEFAULT_VOLUME = 1;

    // Carga inicial de config.json
    fetch("./config.json")
      .then(r => r.json())
      .then(data => {
        config = data;
        if (!config.gifts) config.gifts = {};
        if (!config.interactions) config.interactions = {};
        buildFromConfig();
      })
      .catch(() => {
        buildFromConfig();
      });

    function buildFromConfig() {
      const tbody = document.getElementById("rows");
      tbody.innerHTML = "";

      Object.entries(config.gifts || {}).forEach(([name, item]) => {
        addRowFromConfig("gift", name, item);
      });

      Object.entries(config.interactions || {}).forEach(([name, item]) => {
        addRowFromConfig("interaction", name, item);
      });

      if (!tbody.children.length) {
        // filas base
        addRow("gift", "rosa");
        addRow("gift", "corazon");
        addRow("interaction", "follow");
        addRow("interaction", "like");
      }
    }

    function addRowFromConfig(kind, key, item) {
      const enabled = item.enabled !== false;
      const sound = item.sound || "";
      const duration = item.duration || DEFAULT_DURATION;
      const volume = item.volume != null ? item.volume : DEFAULT_VOLUME;
      addRow(kind, key, sound, duration, volume, enabled);
    }

    function addRow(kind = "gift", trigger = "", sound = "", duration = DEFAULT_DURATION, volume = DEFAULT_VOLUME, enabled = true) {
      const tbody = document.getElementById("rows");
      const tr = document.createElement("tr");
      tr.dataset.kind = kind;

      tr.innerHTML = `
        <td class="col-enabled">
          <div class="toggle ${enabled ? "on" : ""}" onclick="toggleEnabled(this)"></div>
        </td>
        <td class="col-type">
          <select>
            ${EVENT_TYPES.map(t => `<option value="${t.value}" ${t.value === kind ? "selected" : ""}>${t.label}</option>`).join("")}
          </select>
        </td>
        <td class="col-trigger">
          <select>
            ${TRIGGERS.map(t => `<option value="${t}" ${t === trigger ? "selected" : ""}>${t.toUpperCase()}</option>`).join("")}
          </select>
        </td>
        <td>
          <button class="sound-btn" onclick="editSound(this)">
            <span>${sound || "Select sound (ruta .mp3)"}</span>
          </button>
        </td>
        <td>
          <div class="slider-wrapper">
            <input type="range" min="0" max="1" step="0.05" value="${volume}">
            <span>${Math.round(volume * 100)}%</span>
          </div>
        </td>
        <td>
          <input type="number" value="${duration}" min="500" max="20000">
        </td>
        <td class="col-actions">
          <button class="btn" onclick="deleteRow(this)">‚úñ</button>
        </td>
      `;

      const range = tr.querySelector('input[type="range"]');
      range.addEventListener("input", () => {
        tr.querySelector(".slider-wrapper span").textContent = `${Math.round(range.value * 100)}%`;
      });

      tbody.appendChild(tr);
    }

    function toggleEnabled(el) {
      el.classList.toggle("on");
    }

    function deleteRow(btn) {
      const tr = btn.closest("tr");
      tr.remove();
    }

    function editSound(btn) {
      const current = btn.querySelector("span").textContent;
      const placeholder = "Select sound (ruta .mp3)";
      const val = current === placeholder ? "" : current;
      const res = prompt("Ruta del archivo de audio (ej: ./sounds/basicos/rosa.mp3):", val);
      if (res === null) return;
      const text = res.trim() || placeholder;
      btn.querySelector("span").textContent = text;
    }

    function reloadFromConfig() {
      buildFromConfig();
    }

    function clearAll() {
      if (!confirm("¬øSeguro que quieres limpiar gifts e interactions de config.json?")) return;
      config.gifts = {};
      config.interactions = {};
      buildFromConfig();
    }

    function downloadConfig() {
      const tbody = document.getElementById("rows");
      const rows = Array.from(tbody.querySelectorAll("tr"));

      const newGifts = {};
      const newInter = {};

      rows.forEach(tr => {
        const enabled = tr.querySelector(".toggle").classList.contains("on");
        const kind = tr.querySelector("td.col-type select").value; // gift/interaction
        const trigger = tr.querySelector("td.col-trigger select").value;
        const soundLabel = tr.querySelector(".sound-btn span").textContent;
        const sound = soundLabel.startsWith("Select sound") ? "" : soundLabel;
        const volume = parseFloat(tr.querySelector('input[type="range"]').value) || DEFAULT_VOLUME;
        const duration = parseInt(tr.querySelector('input[type="number"]').value) || DEFAULT_DURATION;

        const base = {
          enabled,
          sound,
          duration,
          volume
        };

        if (kind === "gift") {
          const prev = config.gifts && config.gifts[trigger] ? config.gifts[trigger] : {};
          const minCoins = prev.minCoins != null ? prev.minCoins : 1;
          newGifts[trigger] = Object.assign({}, prev, base, { minCoins });
        } else {
          const prev = config.interactions && config.interactions[trigger] ? config.interactions[trigger] : {};
          newInter[trigger] = Object.assign({}, prev, base);
        }
      });

      config.gifts = newGifts;
      config.interactions = newInter;

      const dataStr = JSON.stringify(config, null, 2);
      const uri = "data:application/json;charset=utf-8," + encodeURIComponent(dataStr);
      const link = document.createElement("a");
      link.href = uri;
      link.download = "config.json";
      link.click();
    }
  </script>
</body>
</html>
